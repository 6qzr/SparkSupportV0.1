generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id              String          @id @default(cuid())
  name            String
  email           String          @unique
  phone           String?
  role            String
  department      String?
  passwordHash    String          @map("password_hash")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  sentMessages    TicketMessage[]
  assignedTickets Ticket[]        @relation("AssignedTickets")
  createdTickets  Ticket[]        @relation("CustomerTickets")

  @@map("users")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  tickets     Ticket[]

  @@map("categories")
}

model Ticket {
  id              String          @id
  customerId      String          @map("customer_id")
  assignedStaffId String?         @map("assigned_staff_id")
  categoryId      String          @map("category_id")
  priority        String
  status          String
  subject         String
  description     String
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  messages        TicketMessage[]
  category        Category        @relation(fields: [categoryId], references: [id])
  assignedStaff   User?           @relation("AssignedTickets", fields: [assignedStaffId], references: [id])
  customer        User            @relation("CustomerTickets", fields: [customerId], references: [id])

  @@map("tickets")
}

model TicketMessage {
  id             String   @id @default(cuid())
  ticketId       String   @map("ticket_id")
  senderId       String   @map("sender_id")
  message        String
  attachmentUrls String   @default("[]") @map("attachment_urls")
  isInternal     Boolean  @default(false) @map("is_internal")
  createdAt      DateTime @default(now()) @map("created_at")
  sender         User     @relation(fields: [senderId], references: [id])
  ticket         Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@map("ticket_messages")
}
